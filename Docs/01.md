# NetworkKit 快速入门

## 概述

NetworkKit 是一个基于 Swift Concurrency 和 Alamofire 构建的现代网络框架，采用 **Protocol-Oriented** 设计，提供类型安全的 API 定义和灵活的插件系统。

## 核心概念

```
┌─────────────────────────────────────────────────────────────┐
│                      NetworkProvider                         │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────────────┐ │
│  │PluginRunner │  │RequestBuilder│  │    NetworkClient    │ │
│  └──────┬──────┘  └──────┬──────┘  │    (Alamofire)      │ │
│         │                │          └──────────┬──────────┘ │
└─────────┼────────────────┼─────────────────────┼────────────┘
          │                │                     │
    ┌─────▼─────┐    ┌─────▼─────┐         ┌─────▼─────┐
    │  Plugins  │    │APIRequest │         │    HTTP   │
    │Transform  │    │   enum    │         │  Network  │
    │Observer   │    └───────────┘         └───────────┘
    │Progress   │
    │Retry      │
    └───────────┘
```

## 基本使用

### 1. 定义 API

```swift
import NetworkKit

enum UserAPI: APIRequest {
    case getUser(id: String)
    case createUser(name: String, email: String)
    case uploadAvatar(userId: String, imageData: Data)
    
    // baseURL 可选：不实现则使用 NetworkProvider 配置的默认值
    // 如需覆盖：
    // var baseURL: URL? { URL(string: "https://other-api.com") }
    
    var path: String {
        switch self {
        case .getUser(let id):
            return "/users/\(id)"
        case .createUser:
            return "/users"
        case .uploadAvatar(let userId, _):
            return "/users/\(userId)/avatar"
        }
    }
    
    var method: HTTPMethod {
        switch self {
        case .getUser: return .get
        case .createUser: return .post
        case .uploadAvatar: return .post
        }
    }
    
    var task: RequestTask {
        switch self {
        case .getUser:
            return .plain
        case .createUser(let name, let email):
            return .parameters(
                ["name": name, "email": email],
                encoding: .json
            )
        case .uploadAvatar(_, let imageData):
            return .upload(.data(imageData))
        }
    }
}
```

### 2. 创建 Provider 并发起请求

```swift
let provider = NetworkProvider(
    baseURL: URL(string: "https://api.example.com")!
)

// 方式1：泛型方法直接解码
let user: User = try await provider.request(UserAPI.getUser(id: "123"))

// 方式2：获取原始响应
let response = try await provider.request(UserAPI.getUser(id: "123"))
let user = try JSONDecoder().decode(User.self, from: response.data)
```

### 3. 添加插件

```swift
// 创建带插件的 Provider
let provider = NetworkProvider(
    baseURL: URL(string: "https://api.example.com")!,
    plugins: [
        AuthPlugin(),      // 添加 Token
        LoggingPlugin(),   // 日志记录
    ]
)
```

## 文件结构

```
Sources/NetworkKit/
├── Request/           # 请求定义
│   ├── APIRequest.swift
│   ├── RequestTask.swift
│   ├── HTTPMethod.swift
│   └── ValidationType.swift
├── Response/          # 响应类型
│   ├── APIResponse.swift
│   └── NetworkError.swift
├── Plugin/            # 插件系统
│   ├── Protocol/      # 插件协议
│   │   ├── PluginType.swift
│   │   ├── TransformPlugin.swift
│   │   ├── ObserverPlugin.swift
│   │   ├── ProgressPlugin.swift
│   │   └── RetryPlugin.swift
│   └── Execution/     # 插件执行
│       ├── PluginRunner.swift
│       └── RequestContext.swift
├── Provider/          # 核心调度
│   ├── NetworkProvider.swift
│   ├── RequestBuilder.swift
│   ├── ResponseValidator.swift
│   └── MockBehavior.swift
├── Client/            # HTTP 客户端
│   ├── NetworkClient.swift
│   ├── AlamofireClient.swift
│   └── AlamofireBridge.swift
└── Utils/             # 工具类
    ├── ParameterEncoder.swift
    └── URLBuilder.swift
```
